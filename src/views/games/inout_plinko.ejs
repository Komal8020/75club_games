<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Play In-Out Games Plinko</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        #game-area {
            width: 90%;
            max-width: 1200px;
            height: 700px;
            background-color: #fff;
            border: 1px solid #ddd;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            overflow: hidden;
        }

        #game-frame {
            width: 100%;
            height: 100%;
            border: none;
            visibility: hidden;
        }

        .loading-message {
            font-family: Arial, sans-serif;
            color: #555;
            font-size: 1.2em;
        }

        .error-message {
            font-family: Arial, sans-serif;
            color: red;
            font-size: 1.2em;
        }
    </style>
</head>

<body>
    <div id="game-area">
        <div class="loading-message">Loading Plinko game... Please wait.</div>
        <iframe id="game-frame" scrolling="yes" allow="autoplay; fullscreen" allowfullscreen="true" frameborder="0">
        </iframe>
    </div>

    <script>
        $(document).ready(function () {
            const gameMode = "plinko"; // This is fixed for this Plinko page

            // Make AJAX call to backend to get the In-Out Games launch URL
            // The backend will automatically get the user from the auth cookie
            $.ajax({
                url: `/inout/launch?gameMode=${gameMode}`,
                method: 'GET',
                success: function (response) {
                    if (response.success && response.url) {
                        const gameUrl = response.url;
                        const $gameFrame = $('#game-frame');

                        // Hide loading message
                        $('.loading-message').hide();

                        // Set iframe src and make it visible
                        $gameFrame.attr('src', gameUrl);
                        $gameFrame.css('visibility', 'visible');

                        // Optional: Handle iframe load event
                        $gameFrame.on('load', function () {
                            console.log('In-Out Plinko game iframe loaded.');
                        });

                        $gameFrame.on('error', function () {
                            console.error('Error loading In-Out Plinko game iframe.');
                            $('#game-area').html('<div class="error-message">Failed to load game. Please try again.</div>');
                        });

                    } else {
                        $('#game-area').html('<div class="error-message">Failed to get game URL: ' + (response.message || 'Unknown error from backend') + '</div>');
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.error("AJAX Error:", textStatus, errorThrown, jqXHR.responseText);

                    // Handle specific error cases
                    if (jqXHR.status === 401) {
                        $('#game-area').html('<div class="error-message">Authentication failed. Please <a href="/login">login</a> to play games.</div>');
                    } else if (jqXHR.status === 500) {
                        $('#game-area').html('<div class="error-message">Server error. Please try again later.</div>');
                    } else {
                        $('#game-area').html('<div class="error-message">Failed to connect to game launch service. Please check your connection and try again.</div>');
                    }
                }
            });
        });
    </script>
</body>

</html>